generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id Int @id @default(autoincrement())

  email    String
  password String
  active   Boolean @default(false)
  settings Json    @default("{}")

  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(6)

  currentProfileId Int @map("current_profile_id")

  currentProfile Profile       @relation("UserCurrentProfiles", fields: [currentProfileId], references: [id])
  userProfiles   UserProfile[]

  @@index([email], name: "users_email")
  @@index([currentProfileId], name: "users_current_profile_id")
  @@map("users")
}

model UserProfile {
  id Int @id @default(autoincrement())

  userId    Int @map("user_id")
  profileId Int @map("profile_id")

  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(6)
  expiresAt DateTime? @map("expires_at") @db.Timestamp(6)

  user    User    @relation(fields: [userId], references: [id])
  profile Profile @relation(fields: [profileId], references: [id])

  @@index([userId, profileId], name: "users_profiles_user_id_profile_id")
  @@index([profileId, userId], name: "users_profiles_profile_id_user_id")
  @@map("users_profiles")
}

model Profile {
  id Int @id @default(autoincrement())

  name     String
  document String?
  email    String?
  phone    String?

  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(6)

  userProfiles        UserProfile[]
  userCurrentProfiles User[]        @relation("UserCurrentProfiles")

  @@index([document], name: "profiles_document")
  @@index([email], name: "profiles_email")
  @@map("profiles")
}
